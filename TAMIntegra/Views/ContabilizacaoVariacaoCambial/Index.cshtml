@model Entities.ContabilizacaoVariacaoCambial

@{
    ViewBag.Title = "Painel de metas";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var cont = 1;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    @*<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>*@

    <style>
.tableFixHead {
  /*overflow: auto;*/
  height: 100px;
  width:100%;
}

.tableFixHead table {
  border-collapse: collapse;
  width: 100%;
}

.tableFixHead th,
.tableFixHead td {
  padding: 8px 16px;
}


td:first-child, th:first-child {
  position:sticky;
  left:0;
  z-index:1;
  background-color:white;
}
td:nth-child(2),th:nth-child(2)  { 
position:sticky;
  /*left:40px;*/
  z-index:1;
  background-color:white;
  }
.tableFixHead th {
  position: sticky;
  top: 0;
  background: #f9f9f9;
  z-index:2
}
th:first-child , th:nth-child(2) {
  z-index:3
  }
       .sticky-col {
    position: sticky;
    position: -webkit-sticky;    
    background-color: white;
}
  
.first-col {
	width: 120px;
    min-width: 100px;
    max-width: 340px;
	left: 0px;  
}

.second-col {
    width: 150px;
    min-width: 20px;
    max-width: 340px;
    left: 100px;  
}
.third-col {
    width: 50px;
    min-width: 110px;
    max-width: 340px;
    left: 190px;   
}
.fourth-col {
    width: 100px;
    min-width: 80px;
    max-width: 340px;
    left: 280px;  
}

        input[type=checkbox], input[type=radio] {
            /* margin: 4px 0 0; */
            margin-top: 1px\9;
            line-height: normal;
        }

        @@media screen and (min-width: 992px) {
            .grid-container {
                display: grid;
                grid-template-columns: 80px 60px 150px auto auto auto auto auto;
                padding: 5px;
            }

            .grid-container2 {
                display: grid;
                grid-template-columns: auto auto auto auto auto;
                padding: 5px;
            }

            .grid-item {
                padding: 5px;
                text-align: left;
            }

            .page-wrapper {
                height: 100vh;
            }
        }

        .modalDialog {
            /*Insira o código debaixo de tudo*/
            overflow: scroll;
        }

        .modal-body {
            max-height: calc(110vh - 210px);
            overflow-y: auto;
        }

        .clearfix {
            clear: both;
            padding: 0;
            margin: 0;
            height: 5px;
            display: block;
        }

        .panel-body {
            padding-bottom: 0;
        }

        .panel {
            /*border: 0;*/
            border-width: 5px;
            border-color: #3A2303;
            padding-bottom: 0em;
            height: 100%;
        }

        .form-group {
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .col-md-4 {
            padding-bottom: 5px;
        }

        .btnSemLink {
            display: inline-block;
            padding: 6px 12px;
            margin-bottom: 0;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.42857143;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            /*touch-action: manipulation;*/
            /*cursor: pointer;*/
            -webkit-user-select: none;
            border: 1px solid transparent;
        }

        .modal-dialog {
            display: flex;
            align-items: center;
        }

        .modal-content {
            margin: 0 auto;
        }

        .grid-item {
            padding-bottom: 10PX;
        }

        /*.page-content {
            height: 100vh;
        }*/
        body {
            overflow: auto;
        }

        .fontErro {
            color: red;
        }
    </style>
</head>
@using (Html.BeginForm("Index", "ContabilizacaoVariacaoCambial", FormMethod.Post, new { id = "myForm" }))
{
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.AntiForgeryToken()



    <body>
        <input hidden id="fornecedorSelected" name="fornecedorSelected" />
        <input hidden id="documentoSelected" name="documentoSelected" />
        <input hidden id="tipoHidden" name="tipoHidden" value="@Model.Tipo" />
        <input hidden id="classificacaoHidden" name="classificacaoHidden" value="@Model.Classificacao" />

        <main class="page-content" style="margin-top:0;padding-top:0;position:fixed;top:4px;left:21px;width:97%;z-index:100;">
            <div class="stepwizard" style="padding-bottom:0;padding-left:0;left:14px;position:relative;">
                <fieldset>
                    <legend style="margin-bottom:0;top:0;font-size:18px;background-color:white">Contabilização - Variação Cambial</legend>
                </fieldset>
            </div>
        </main>
        <div class="page-wrapper chiller-theme">
            <main class="page-content">
                <div class="container-fluid" style="padding-top:50px;padding-left:30px">
                    <div id="divPedidosSelecionados" @*style="margin-left:120px;"*@>

                        <div class="panel with-nav-tabs panel-default" style="margin-bottom:0">
                            <div class="panel-heading" style="background-color:lightgray">
                                Fechamento Contábil
                            </div>
                            <div class="panel-body" style="padding-bottom:0;">
                                <div class="tab-content">
                                    <div class="grid-container" style="display:flex;justify-content:space-between">
                                        <div class="grid-item">
                                            <label class="form-negrito">Ano</label>
                                            @*@Html.DropDownList("movimento", (SelectList)ViewBag.Movimentos, "-- Selecione --", new { @style = "width:150px;height:26px", @class = "chosen-select" })*@
                                            @Html.Editor("ano", new { htmlAttributes = new { @style = "width:80px;height:26px", @class = "form-control", @autocomplete = "off", maxlengh = "4" } })
                                            @*<input type="text" maxlength="6" style = "width:200px;height:26px" autocomplete="off" class="form-control" id="movimento" name="movimento"/>*@
                                            <div id="divErroMovimento" class="fontErro"></div>
                                        </div>
                                        <div class="grid-item">
                                            <label class="form-negrito">Mês</label>
                                            @Html.Editor("mes", new { htmlAttributes = new { @style = "width:60px;height:26px", @class = "form-control", @autocomplete = "off", @maxlengh = 2 } })
                                            @*<input type="text" maxlength="35" style="width:200px;height:26px" autocomplete="off" class="form-control" id="numeroMovimentoFiltro" name="numeroMovimentoFiltro"/>*@
                                            <div id="divErroNumeroMovimento" class="fontErro"></div>
                                        </div>
                                        <div class="grid-item">
                                            <label class="form-negrito">Cód. Processo</label>
                                            @Html.Editor("codProcesso", new { htmlAttributes = new { @style = "width:150px;height:26px", @class = "form-control", @autocomplete = "off", @maxlengh = 12 } })
                                        </div>
                                        <div class="grid-item">
                                            <label class="form-negrito">Invoice</label>
                                            @Html.Editor("invoice", new { htmlAttributes = new { @style = "width:200px;height:26px", @class = "form-control", @autocomplete = "off", @maxlengh = 18 } })
                                        </div>
                                        <div class="grid-item">
                                            <label class="form-negrito">Tipo (Aba Tela)</label>
                                            <select id="tipo" name="tipo" class="chosen-select" multiple>
                                                @*<option selected>-- Selecione --</option>*@
                                                <option value="VC_MATERIAL">VC_MATERIAL</option>
                                                <option value="VC_PRODUTO">VC_PRODUTO</option>
                                            </select>
                                        </div>
                                        <div class="grid-item">
                                            <label class="form-negrito">Classificação</label>
                                            <select id="classificacao" name="classificacao" class="chosen-select" multiple>
                                                @*<option selected>-- Selecione --</option>*@
                                                <option value="VC_NAO_EFETIVA">VC_NAO_EFETIVA</option>
                                                <option value="VC_EFETIVA">VC_EFETIVA</option>
                                            </select>
                                        </div>
                                        <div style="padding-top:16px">
                                            <button class="btn btn-primary btn-sm"  id="btnFiltro" type="button" name="Filtrar">Exibir</button>
                                            @if (Model != null)
                                            {
                                                if (Model.lstVariacaoCambial != null)
                                                {
                                                    if (Model.lstVariacaoCambial.Count > 0)
                                                    {
                                                        <a class="btn btn-success btn-sm" title="Download Excel" onclick="location.href='@Url.Action("DownloadExcel", "ContabilizacaoVariacaoCambial")'">Exportar</a>
                                                    }
                                                }
                                                else
                                                {
                                                    <a class="btn btn-success btn-sm" title="Download Excel" onclick="alert('Não há dados a serem exportados.')">Exportar</a>
                                                }
                                            }
                                            else
                                            {
                                                <a class="btn btn-success btn-sm" title="Download Excel" onclick="alert('Não há dados a serem exportados.')">Exportar</a>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <br />


                        <div class="panel with-nav-tabs panel-default" style="padding-bottom: 0;margin-bottom:0">
                            <div class="panel-heading" style="background-color:lightgray">
                                Variação Contábil
                            </div>
                            <div class="panel-body" style="padding-bottom: 0;margin-bottom:0">
                                @if (Model != null)
                                {
                                    <div class="tableFixHead" style="overflow:auto;height:1%;max-height:370px">
                                        <table class="table table-striped" id="tblItens" style="margin-bottom:0">
                                            <thead>
                                                <tr>

                                                    <th class="sticky-col first-col" style="text-align:left;min-width: 120px;">Cód. Processo</th>
                                                    <th class="sticky-col second-col" style="text-align:center;min-width: 110px;background-clip:padding-box">Invoice</th>
                                                    <th class="" style="text-align:center;min-width:125px">Moeda</th>
                                                    <th class="" style="text-align:center;min-width:70px">Vl. MN RM</th>
                                                    <th style="text-align:center;min-width:10px">Sinal</th>
                                                    <th style="text-align:center;min-width:125px">Conta Contábil 1</th>
                                                    <th style="text-align:center;min-width: 160px">Conta Contrapartida</th>
                                                    <th style="text-align:center;min-width: 80px">Dt. Contábil</th>
                                                    <th style="text-align:center;min-width:100px">Dt. Emissão Doc</th>
                                                    <th style="text-align:center;min-width: 120px;">Dt. Transação</th>
                                                    <th style="text-align:center;min-width:100px">Tipo</th>
                                                    <th style="text-align:center;min-width:70px">Classificação</th>
                                                    <th style="text-align:center;min-width:125px">Cód. Parceiro</th>
                                                    <th style="text-align:center;min-width:125px">Mvto RM</th>
                                                    <th style="text-align:center;min-width:450px">Histórico</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @*a nota nr numid sera integrada no rm.
                                Deseja continuar?*@
                                                @if (Model.lstVariacaoCambial != null)
                                                {
                                                    foreach (Entities.ContabilizacaoVariacaoCambial item in Model.lstVariacaoCambial)
                                                    {
                                                        cont += 1;
                                                        //for (int i = 0; i < Model.lstItens.Count; i++)
                                                        //{
                                                        if (cont % 2 == 0)
                                                        {
                                                            <tr>

                                                                @*@if (@item.EMISSAO == null || @item.EMISSAO == "")
                                                                {
                                                                    <td class="sticky-col first-col border" style="vertical-align:top;text-align:center;background-color:#f9f9f9;background-clip: padding-box">
                                                                        <a class="btn modalExcel" style="padding:0" title="Reprocessar"><span class="fa fa-refresh" style="font-size:12px;" onclick="if(confirm('A nota @item.ID_BrokerSys será integrada no RM. Deseja continuar?'))  Reprocessar(@item.Id_Integracao, @item.NUMNF_BrokerSys, @item.ID_BrokerSys)"></span></a>
                                                                    </td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="sticky-col first-col border" style="vertical-align:top;text-align:center;background-color:#f9f9f9;background-clip: padding-box"></td>
                                                                }*@

                                                                <th style="text-align:left;width: 120px;">
                                                                    <div class="btn-toolbar" style="margin-left:0">
                                                                        @if (item.Exibir_Check == "S")
                                                                        {
                                                                            <input type="checkbox" id="ckRegistros" class="chkclass" />
                                                                        }
                                                                        @item.Cod_Processo
                                                                    </div>
                                                                </th>
                                                                <td class="sticky-col second-col" style="text-align:center;background-color:#f9f9f9;background-clip:padding-box">@item.Invoice</td>
                                                                <td style="text-align:center">@item.Moeda</td>
                                                                @if (item.Valor_MN_RM != null)
                                                                {
                                                                    <td style="text-align:right">@string.Format("{0:#,##0.00#}", item.Valor_MN_RM)</td>
                                                                }
                                                                else
                                                                {
                                                                    <td style="text-align:right"></td>
                                                                }
                                                                <td style="text-align:center">@item.Sinal</td>
                                                                <td style="text-align:center">@item.Conta_Contabil1</td>
                                                                <td style="text-align:center">@item.Conta_Contrapartida</td>
                                                                <td style="text-align:center">@item.Dt_Contabil.ToString("dd/MM/yyyy")</td>
                                                                <td style="text-align:center">@item.Dt_Contabil.ToString("dd/MM/yyyy")</td>
                                                                <td style="text-align:center">@item.Dt_Transacao.ToString("dd/MM/yyyy")</td>
                                                                <td style="text-align:center">@item.Tipo</td>
                                                                <td style="text-align:center">@item.Classificacao</td>
                                                                <td style="text-align:center">@item.Cod_Parceiro</td>
                                                                <td style="text-align:center">@item.Mvto_RM</td>
                                                                <td style="text-align:center">@item.Historico</td>
                                                                <td hidden class="id_integracao">@item.Id_Lancamento</td>
                                                                <td hidden class="id_lancamento">@item.Id_Integracao</td>
                                                            </tr>
                                                        }
                                                        else
                                                        {
                                                            <tr>
                                                                <th style="text-align:left;width: 120px;background-color:white">
                                                                    <div class="btn-toolbar" style="margin-left:0">
                                                                        @if (item.Exibir_Check == "S")
                                                                        {
                                                                            <input type="checkbox" id="ckRegistros" class="chkclass"/>
                                                                        }
                                                                        @item.Cod_Processo
                                                                    </div>
                                                                </th>
                                                                <td class="sticky-col second-col" style="text-align:center;background-clip:padding-box">@item.Invoice</td>
                                                                <td style="text-align:center">@item.Moeda</td>
                                                                @if (item.Valor_MN_RM != null)
                                                                {
                                                                    <td style="text-align:right">@string.Format("{0:#,##0.00#}", item.Valor_MN_RM)</td>
                                                                }
                                                                else
                                                                {
                                                                    <td style="text-align:right"></td>
                                                                }
                                                                <td style="text-align:center">@item.Sinal</td>
                                                                <td style="text-align:center">@item.Conta_Contabil1</td>
                                                                <td style="text-align:center">@item.Conta_Contrapartida</td>
                                                                <td style="text-align:center">@item.Dt_Contabil.ToString("dd/MM/yyyy")</td>
                                                                <td style="text-align:center">@item.Dt_Contabil.ToString("dd/MM/yyyy")</td>
                                                                <td style="text-align:center">@item.Dt_Transacao.ToString("dd/MM/yyyy")</td>
                                                                <td style="text-align:center">@item.Tipo</td>
                                                                <td style="text-align:center">@item.Classificacao</td>
                                                                <td style="text-align:center">@item.Cod_Parceiro</td>
                                                                <td style="text-align:center">@item.Mvto_RM</td>
                                                                <td style="text-align:center">@item.Historico</td>
                                                                <td hidden class="id_integracao">@item.Id_Lancamento</td>
                                                                <td hidden class="id_lancamento">@item.Id_Integracao</td>
                                                            </tr>
                                                        }
                                                        //}
                                        


                                                        @*<td><a class="modalBTN" style="padding:0;font-size:12px;text-decoration:none;color:black;font-size:14px;pointer-events:none">@item.NUMEROMOV</a></td>*@

                                                    }
                                                    <tr>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white;z-index:100"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        @if (@ViewBag.Valor != null)
                                                        {
                                                            <td style="text-align:right;position:sticky;bottom:0;background:white">@string.Format("{0:#,##0.00#}", @ViewBag.Valor)</td>
                                                        }
                                                        else
                                                        {
                                                            <td style="text-align:right"></td>
                                                        }
                                                        
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                        <td style="text-align:right;position:sticky;bottom:0;background:white"></td>
                                                    </tr>
                                                }

                                            </tbody>
                                        </table>
                                       

                                       
                                    </div>
                                }

                                <div class="btn-toolbar" style="margin-bottom:10px">
                                    <button class="btn btn-primary nextBtn btn-md pull-right" type="button" onclick="Excluir()">Excluir Contabilização</button>
                                    <button class="btn btn-primary nextBtn btn-md pull-right" type="button" onclick="Reprocessar()">Reprocessar Contabilização</button>
                                </div>
                                @*<button class="btn btn-primary nextBtn btn-md pull-right" type="submit">Continuar</button>*@
                            </div>

                          

                        </div>

                </div>


            </main>
        </div>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="~/scripts/jquery-ui.js"></script>
        <link href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" rel="stylesheet" type="text/css">

        <script type="text/javascript" src="~/scripts/chosen.jquery.js"></script>
        @*<script src="~/scripts/importacaoproduto2.js"></script>*@
        <link rel="stylesheet" type="text/css" href="~/Content/chosen.css" />
        <link href="~/content/indexCompras.css" rel="stylesheet" />
        <link href="~/content/indexImportacaoProduto.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.2/css/bootstrapValidator.min.css" rel="stylesheet" />
        <!-- bootstrap Validator JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.2/js/bootstrapValidator.min.js"></script>

        <script>
            $("document").ready(function () {
                var tipo = $('#tipoHidden').val();
                $('#tipo').val(tipo);
                $("#tipo").trigger("chosen:updated");

                var tipo = $('#classificacaoHidden').val();
                $('#classificacao').val(tipo);
                $("#classificacao").trigger("chosen:updated");
            });
        $(function () {
            $(".datepickerInput").datepicker({ dateFormat: 'dd/mm/yy' }).val();
        });


        


        //$("#btnFiltro").click(function () {
        //    $('#myForm').bootstrapValidator({
        //        message: 'No es valido',
        //        framework: 'bootstrap',
        //        feedbackIcons: {
        //            //valid: 'glyphicon glyphicon-ok',
        //            //invalid: 'glyphicon glyphicon-remove',
        //            //validating: 'glyphicon glyphicon-refresh'
        //        },
        //        submitButtons: 'button[name="Filtrar"]',
        //        fields: {

        //            numeroMovimentoFiltro: {
        //                validators: {
        //                    notEmpty: {
        //                        message: 'Digite o número do movimento.'
        //                    },
        //                    stringLength: {
        //                        max: 100,
        //                        message: 'Digite até 100 caracteres.'
        //                    }
        //                }
        //            },
        //            codigoFiltro: {
        //                validators: {
        //                    stringLength: {
        //                        max: 10,
        //                        message: 'Digite até 10 caracteres.'
        //                    }
        //                }
        //            },
        //            nomeFantasiaFiltro: {
        //                validators: {
        //                    stringLength: {
        //                        max: 10,
        //                        message: 'Digite até 10 caracteres.'
        //                    }
        //                }
        //            }
        //        }
        //    })

        //});


        $("#btnFiltro").click(function () {


            var ano = $('#ano').val();
            var mes = $('#mes').val();
            var codProcesso = $('#codProcesso').val();
            var invoice = $('#invoice').val();
            var tipo = $('#tipo').val();

            if  ((mes.length > 0 & ano != '' & ano != null) || ((codProcesso != '' & codProcesso != null) || (invoice != '' & invoice != null) || (tipo != '-- Selecione --' & tipo != null & tipo != '')))
            {
                if ((ano == '' || ano == null) & (mes != '' & mes != null)) {
                    alert("Digite o ano.");
                }
                else
                {
                    var filtrar = $("<input>")
                         .attr("type", "hidden")
                         .attr("name", "filtrar").val("filtrar");

                    $('#myForm').append($(filtrar));
                    document.getElementById("myForm").submit();
                }
             
            }
            else {
             
                if ((ano == '' || ano == null) || (mes.length == 0))
                {
                    alert("Digite o ano e o mês.");
                }
                else
                {
                    alert("Necessário digitar ao menos o ano.")
                    $("#btnFiltro").attr("disabled", true)
                }
            }
        });

        $("#ano").keyup(function () {
            $("#btnFiltro").attr("disabled", false)
        });

        $("#mes").keyup(function () {
            $("#btnFiltro").attr("disabled", false);
        });

        $("#codProcesso").keyup(function () {
            $("#btnFiltro").attr("disabled", false)
        });

        $("#invoice").keyup(function () {
            $("#btnFiltro").attr("disabled", false)
        });

        $("#tipo").change(function () {
            $("#btnFiltro").attr("disabled", false)
        });

        $("#mes").change(function () {
            $("#btnFiltro").attr("disabled", false)
        });

     

            $('a.modalBTN').click(function () {
                $('#my-modal').modal({
                    show: true,
                    closeOnEscape: true,
                    backdrop: 'static',
                    keyboard: false
                })
            });

            function desbloquearPedido(idIntegracao, idMov) {
                $.ajax({
                    url: '@Url.Action("DesbloquearPedido", "ImportacaoProduto")',
                    type: 'get',
                    data: { idIntegracao: idIntegracao, idMov: idMov },
                    //success: function (data) { $('#exampleModal').toggle(); }
                    success: function (data) { $('#myForm').submit(); }
                });
            }

        //$("#btnAgendar").click(function () {
        //    $('#lstProdutos tr input[type="checkbox"]:checked').each(function () {
        //        var $row = $(this).closest('tr');
        //        //used :not(:first-child) to skip first element (the checkbox td)
        //        $('td', $row).each(function (i) {
        //            var linhas = $(this).text();
        //            //alert(linhas);
        //        })
        //    });
            //});

            function agendarIntegracao()
            {
                movimento = $('#nroMovimento').val();
                var id_fornecedor = $('#fornecedorNome').val();
                var documento = $('#documento').val();
                var idLstConciliacao = $('#lstProdutos input:checked').map(function () {
                    if (this.value != "" & this.value != null) {
                        return this.value;
                    }
                }).get().join(', ');
                //alert(idLstConciliacao);

                //var idMov = $('#idMovItem').html();

                //var fornecedor = $("#fornecedorNome option:selected").val();
                //var movimento = $("#documento option:selected").text();


                //var table = $('#lstProdutos');
                //var data2 = [];

                //table.find('tr').each(function (i, el) {
                //    // no thead
                //    if (i != 0) {
                //        var $tds = $(this).find('td');
                //        var row = [];
                //        $tds.each(function (i, el) {
                //            row.push($(this).text());
                //        });
                //        data2.push(row);
                //    }

                //});
                //alert(data2);
                jQuery.ajaxSettings.traditional = true;

                $.ajax({
                    url: '@Url.Action("agendarIntegracao", "ImportacaoProduto")',
                    //dataType: "json",
                    contentType: 'json',
                    data: { idPrd: idLstConciliacao, id_fornecedor: id_fornecedor, movimento: documento },
                    success: function (response) {

                        $('#id_integracao').remove();
                        var input = $("<input>")
                          .attr("type", "hidden")
                          .attr("name", "id_integracao").val(response);

                        $('#myForm').append($(input));

                        $("#myForm").submit();
                    },
                    erro: function (data) {
                          //alert('');
                    },
                });
                //alert("Integração agendada com sucesso.");
            };

            //$('#ckRegistros').click(function () {
            //    $('input:checkbox').not(this).prop('checked', this.checked);
            //})

            function Reprocessar() {
                var id_integracao = 0;
                var id_lancamento = '';
                var arrChk = [];

                $('.chkclass:checked').each(function () {
                    id_integracao = $(this).closest('tr').find('.id_integracao').html();
                    id_lancamento = $(this).closest('tr').find('.id_lancamento').html();
                    arrChk.push(id_integracao + ',' + id_lancamento);
                });
             
                if (arrChk == '')
                {
                    alert('Selecione ao menos um item.')
                }
                else
                {
                    $.ajax({
                        url: '@Url.Action("Reprocessar", "ContabilizacaoVariacaoCambial")',
                        traditional: true,
                        data: { dados: arrChk },
                        contentType: 'json',

                        success: function (response) {

                            //if (response[0].Observacao != null & response[0].Observacao != '') {
                            //    alert(response[0]);
                            //}
                            //else {
                            //    $('#id_integracao').remove();
                            //    var input = $("<input>")
                            //    .attr("type", "hidden")
                            //    .attr("name", "id_integracao").val(response[0].Id_Integracao);
                            //    $('#myForm').append($(input));

                            //    $('#myForm').submit();

                            //    $('#myForm').submit();
                            //}
                        },
                        error: function (xhr, textStatus, exceptionThrown) {
                            alert(exceptionThrown);
                        },
                    });
                }
                
            }

            function Excluir() {
                var id_integracao = 0;
                var id_lancamento = '';
                var arrChk = [];

                $('.chkclass:checked').each(function () {
                    id_integracao = $(this).closest('tr').find('.id_integracao').html();
                    id_lancamento = $(this).closest('tr').find('.id_lancamento').html();
                    arrChk.push(id_integracao + ',' + id_lancamento);
                });

                if (arrChk == '') {
                    alert('Selecione ao menos um item.')
                }
                else {
                    $.ajax({
                        url: '@Url.Action("Excluir", "ContabilizacaoVariacaoCambial")',
                        traditional: true,
                        data: { dados: arrChk },
                        contentType: 'json',

                        success: function (response) {

                            //if (response[0].Observacao != null & response[0].Observacao != '') {
                            //    alert(response[0]);
                            //}
                            //else {
                            //    $('#id_integracao').remove();
                            //    var input = $("<input>")
                            //    .attr("type", "hidden")
                            //    .attr("name", "id_integracao").val(response[0].Id_Integracao);
                            //    $('#myForm').append($(input));

                            //    $('#myForm').submit();

                            //    $('#myForm').submit();
                            //}
                        },
                        error: function (xhr, textStatus, exceptionThrown) {
                            alert(exceptionThrown);
                        },
                    });
                }

            }

            $('.menuContabilizacao .sidebar-submenu').addClass("active");
            $('.menuContabilizacao .sidebar-submenu').toggle();
        </script>


    </body>
}
</html>